<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Entry/Exit Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#1e40af",
              secondary: "#3b82f6",
              accent: "#06b6d4",
              dark: "#1f2937",
              light: "#f8fafc",
            },
          },
        },
      };
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="flex h-screen">
      <%- include('partials/sidebar') %>

      <main class="flex-1 overflow-y-auto lg:ml-0">
        <%- include('partials/header', { title: 'Dashboard' }) %>

        <!-- Dashboard Content -->
        <div class="p-4 lg:p-6">
          <!-- Welcome Section -->
          <div class="mb-6 lg:mb-8">
            <div
              class="bg-gradient-to-r from-blue-600 to-cyan-600 rounded-xl lg:rounded-2xl text-white p-4 lg:p-6 shadow-lg"
            >
              <div class="flex items-center justify-between">
                <div>
                  <h1 class="text-xl lg:text-3xl font-bold mb-2">
                    Welcome Back!
                  </h1>
                  <p class="text-blue-100 text-sm lg:text-base">
                    You are logged in as
                    <span
                      class="bg-white/20 px-2 lg:px-3 py-1 rounded-full text-xs lg:text-sm font-semibold"
                      ><%= user.role.toUpperCase() %></span
                    >
                  </p>
                </div>
                <div class="hidden md:block">
                  <i
                    class="fas fa-user-shield text-4xl lg:text-6xl opacity-20"
                  ></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Stats Cards -->
          
          <div
            class="grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-6 mb-6 lg:mb-8"
          >

          <!-- Today's User Entries -->
            <div
              class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-md transition-shadow"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs lg:text-sm font-medium text-gray-600">
                    Today's User Entries
                  </p>
                  <p
                    class="text-lg lg:text-3xl font-bold text-blue-600"
                    id="today-entries"
                  >
                    -
                  </p>
                </div>
                <div class="bg-blue-100 rounded-full p-2 lg:p-3">
                  <i
                    class="fas fa-sign-in-alt text-blue-600 text-lg lg:text-xl"
                  ></i>
                </div>
              </div>
            </div>

            <!-- Today's User Exits -->
            <div
              class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-md transition-shadow"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs lg:text-sm font-medium text-gray-600">
                    Today's User Exits
                  </p>
                  <p
                    class="text-lg lg:text-3xl font-bold text-green-600"
                    id="today-exits"
                  >
                    -
                  </p>
                </div>
                <div class="bg-green-100 rounded-full p-2 lg:p-3">
                  <i class="fas fa-sign-out-alt text-green-600 text-lg lg:text-xl"></i>
                </div>
              </div>
            </div>

            <!-- Today's Guest Check-ins -->
            <div
              class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-md transition-shadow"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs lg:text-sm font-medium text-gray-600">
                    Today's Guest Check-ins
                  </p>
                  <p
                    class="text-lg lg:text-3xl font-bold text-pink-600"
                    id="today-guest-checkins"
                  >
                    -
                  </p>
                </div>
                <div class="bg-pink-100 rounded-full p-2 lg:p-3">
                  <i
                    class="fas fa-user-friends text-pink-600 text-lg lg:text-xl"
                  ></i>
                </div>
              </div>
            </div>

            <!-- Today's Guest Check-outs -->
            <div
              class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-md transition-shadow"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs lg:text-sm font-medium text-gray-600">
                    Today's Guest Check-outs
                  </p>
                  <p
                    class="text-lg lg:text-3xl font-bold text-purple-600"
                    id="today-guest-checkouts"
                  >
                    -
                  </p>
                </div>
                <div class="bg-purple-100 rounded-full p-2 lg:p-3">
                  <i class="fas fa-user-minus text-purple-600 text-lg lg:text-xl"></i>
                </div>
              </div>
            </div>
          </div>

            <!-- Today's Revenue 
            <div
              class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-md transition-shadow"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs lg:text-sm font-medium text-gray-600">
                    Today's Revenue
                  </p>
                  <p
                    class="text-lg lg:text-3xl font-bold text-purple-600"
                    id="today-revenue"
                  >
                    -
                  </p>
                </div>
                <div class="bg-purple-100 rounded-full p-2 lg:p-3">
                  <i
                    class="fas fa-coins text-purple-600 text-lg lg:text-xl"
                  ></i>
                </div>
              </div>
            </div>-->

            <!-- Active Categories 
            <div
              class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-md transition-shadow"
            >
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs lg:text-sm font-medium text-gray-600">
                    Categories
                  </p>
                  <p class="text-lg lg:text-3xl font-bold text-orange-600">5</p>
                </div>
                <div class="bg-orange-100 rounded-full p-2 lg:p-3">
                  <i class="fas fa-tags text-orange-600 text-lg lg:text-xl"></i>
                </div>
              </div>
            </div>-->
          </div>

          <!-- Quick Actions -->
          <div
            class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6 mb-6 lg:mb-8"
          >
            <!-- Entry Management -->
            <a href="/dashboard/entry" class="group block">
              <div
                class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-lg hover:border-blue-300 transition-all duration-200 group-hover:scale-[1.02]"
              >
                <div class="flex items-center mb-3 lg:mb-4">
                  <div
                    class="bg-blue-100 group-hover:bg-blue-200 rounded-lg p-2 lg:p-3 transition-colors"
                  >
                    <i
                      class="fas fa-door-open text-blue-600 text-lg lg:text-2xl"
                    ></i>
                  </div>
                  <h3
                    class="text-base lg:text-lg font-semibold text-gray-900 ml-4"
                  >
                    Entry Management
                  </h3>
                </div>
                <p class="text-gray-600 text-xs lg:text-sm">
                  Process entries and exits, manage guest access, and view all of the entries.
                </p>
                <div
                  class="mt-3 lg:mt-4 flex items-center text-blue-600 text-xs lg:text-sm font-medium"
                >
                  <span>Manage Entries</span>
                  <i
                    class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"
                  ></i>
                </div>
              </div>
            </a>

            <!-- Facility Management -->
            <a href="/dashboard/facilities" class="group block">
              <div
                class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-lg hover:border-orange-300 transition-all duration-200 group-hover:scale-[1.02]"
              >
                <div class="flex items-center mb-3 lg:mb-4">
                  <div
                    class="bg-orange-100 group-hover:bg-orange-200 rounded-lg p-2 lg:p-3 transition-colors"
                  >
                    <i
                      class="fas fa-building text-orange-600 text-lg lg:text-2xl"
                    ></i>
                  </div>
                  <h3
                    class="text-base lg:text-lg font-semibold text-gray-900 ml-4"
                  >
                    Facility Management
                  </h3>
                </div>
                <p class="text-gray-600 text-xs lg:text-sm">
                  Add, manage and update facilities for registered users.
                </p>
                <div
                  class="mt-3 lg:mt-4 flex items-center text-orange-600 text-xs lg:text-sm font-medium"
                >
                  <span>Manage Facilities</span>
                  <i
                    class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"
                  ></i>
                </div>
              </div>
            </a>

            <!-- People Management 
            <a href="/dashboard/people" class="group block">
              <div
                class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-lg hover:border-green-300 transition-all duration-200 group-hover:scale-[1.02]"
              >
                <div class="flex items-center mb-3 lg:mb-4">
                  <div
                    class="bg-green-100 group-hover:bg-green-200 rounded-lg p-2 lg:p-3 transition-colors"
                  >
                    <i
                      class="fas fa-users text-green-600 text-lg lg:text-2xl"
                    ></i>
                  </div>
                  <h3
                    class="text-base lg:text-lg font-semibold text-gray-900 ml-3 lg:ml-4"
                  >
                    People Management
                  </h3>
                </div>
                <p class="text-gray-600 text-xs lg:text-sm">
                  Add, edit, and manage people, families, and card generation.
                </p>
                <div
                  class="mt-3 lg:mt-4 flex items-center text-green-600 text-xs lg:text-sm font-medium"
                >
                  <span>Manage People</span>
                  <i
                    class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"
                  ></i>
                </div>
              </div>
            </a>-->

            <!-- Reports & Analytics -->
            <a href="/dashboard/reports" class="group block">
              <div
                class="bg-white rounded-lg lg:rounded-xl shadow-sm border border-gray-200 p-4 lg:p-6 hover:shadow-lg hover:border-purple-300 transition-all duration-200 group-hover:scale-[1.02]"
              >
                <div class="flex items-center mb-3 lg:mb-4">
                  <div
                    class="bg-purple-100 group-hover:bg-purple-200 rounded-lg p-2 lg:p-3 transition-colors"
                  >
                    <i
                      class="fas fa-chart-bar text-purple-600 text-lg lg:text-2xl"
                    ></i>
                  </div>
                  <h3
                    class="text-base lg:text-lg font-semibold text-gray-900 ml-3 lg:ml-4"
                  >
                    Reports & Analytics
                  </h3>
                </div>
                <p class="text-gray-600 text-xs lg:text-sm">
                  View detailed reports, analytics, and export data on demand.
                </p>
                <div
                  class="mt-3 lg:mt-4 flex items-center text-purple-600 text-xs lg:text-sm font-medium"
                >
                  <span>View Reports</span>
                  <i
                    class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"
                  ></i>
                </div>
              </div>
            </a>
          </div>
        </div>
      </main>
    </div>

    <script>
      // Load dashboard data
      async function loadDashboardData() {
        try {
          // Load daily summary
          const summaryResponse = await fetch("/api/daily-summary");
          let summaryData;
          try {
            summaryData = await summaryResponse.json();
          } catch (jsonError) {
            const todayEntriesEl = document.getElementById("today-entries");
            const todayRevenueEl = document.getElementById("today-revenue");
            if (todayEntriesEl) todayEntriesEl.textContent = "-";
            if (todayRevenueEl) todayRevenueEl.textContent = "-";
            console.error(
              "API did not return JSON. Possible session/auth error."
            );
            return;
          }
          if (summaryData.success) {
            const todayEntriesEl = document.getElementById("today-entries");
            const todayRevenueEl = document.getElementById("today-revenue");
            if (todayEntriesEl) todayEntriesEl.textContent = summaryData.summary.total_entries || 0;
            if (todayRevenueEl) todayRevenueEl.textContent = "Rs. " + (summaryData.summary.total_revenue || 0);
          }
          // Fetch today's check-ins and check-outs from ZKBioTime
          const checkinRes = await fetch("/api/today-checkin-checkout");
          const checkinData = await checkinRes.json();
          if (checkinData.success) {
            const todayEntriesEl = document.getElementById("today-entries");
            if (todayEntriesEl) todayEntriesEl.textContent = checkinData.total_checkins;
            const todayExitsEl = document.getElementById("today-exits");
            if (todayExitsEl) todayExitsEl.textContent = checkinData.total_checkouts;
          }

          // Fetch today's guest statistics
          const guestStatsRes = await fetch("/api/guest-stats");
          const guestStatsData = await guestStatsRes.json();
          if (guestStatsData.success) {
            const guestCheckinsEl = document.getElementById("today-guest-checkins");
            if (guestCheckinsEl) guestCheckinsEl.textContent = guestStatsData.checkins || 0;
            const guestCheckoutsEl = document.getElementById("today-guest-checkouts");
            if (guestCheckoutsEl) guestCheckoutsEl.textContent = guestStatsData.checkouts || 0;
          }
        } catch (error) {
          console.error("Error loading dashboard data:", error);
        }
      }

      // Load data when page loads
      document.addEventListener("DOMContentLoaded", function () {
        loadDashboardData();
      });
    </script>

    <%- include('partials/toast') %>
  </body>
</html>
